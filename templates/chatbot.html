<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>みまくん Chatbot</title>
  <style>
    body { margin: 0; padding: 0; font-family: sans-serif; background: #f5f5f5; }
    .chat-container { display: flex; flex-direction: column; height: 100vh; }
    .chat-window { flex: 1; overflow-y: auto; padding: 1rem; }
    .message { max-width: 80%; margin-bottom: 0.5rem; padding: 0.75rem 1rem; border-radius: 1rem; word-wrap: break-word; }
    .message.user { align-self: flex-end; background: #dcf8c6; border-bottom-right-radius: 0; }
    .message.bot  { align-self: flex-start; background: #fff;       border-bottom-left-radius: 0; }
    .input-area { display: flex; padding: 0.5rem; border-top: 1px solid #ddd; background: #fff; }
    .input-area input[type="text"] { flex: 1; padding: 0.5rem; border: 1px solid #ccc; border-radius: 1rem; outline: none; }
    .input-area button { margin-left: 0.5rem; padding: 0.5rem 1rem; border: none; border-radius: 1rem; background: #007bff; color: #fff; cursor: pointer; }
    @media (max-width: 600px) {
      .message { max-width: 100%; }
      .input-area { flex-direction: column; }
      .input-area button { margin: 0.5rem 0 0 0; }
    }
  </style>
</head>
<body>
<div class="chat-container">
  <div class="chat-window" id="chatLog"></div>
  <form class="input-area" id="chatForm">
    <input type="text" id="userInput" placeholder="メッセージを入力..." autocomplete="off">
    <button type="submit">送信</button>
  </form>
</div>
<script>
  const form = document.getElementById('chatForm');
  const chatLog = document.getElementById('chatLog');
  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    const text = document.getElementById('userInput').value.trim();
    if (!text) return;
    appendMessage(text, 'user');
    document.getElementById('userInput').value = '';
    chatLog.scrollTop = chatLog.scrollHeight;

    const res = await fetch('/chat', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ text })
    });
    const data = await res.json();
    const reply = data.reply || data.error;
    appendMessage(reply, 'bot');
    chatLog.scrollTop = chatLog.scrollHeight;
  });

  function appendMessage(text, role) {
    const msg = document.createElement('div');
    msg.classList.add('message', role);
    msg.textContent = text;
    chatLog.appendChild(msg);
  }
</script>
</body>
</html>
